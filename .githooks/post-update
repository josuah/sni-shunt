#!/bin/sh -ex
trap 'rm -rf "$tmp"' INT TERM EXIT HUP
tmp=$(git-hooks-workdir "$@")

cd "$tmp/doc"
notwiki-doc html /srv/http/vhost/code/sni-shunt .
notwiki-doc gph /srv/gopher/code/sni-shunt .
notwiki-mandoc gph utf8 /srv/gopher/man .
notwiki-mandoc html html /srv/http/vhost/code/man .
cp style.css /srv/http/vhost/code

cd "$tmp"
make dist
cp *.tar.gz /srv/http/vhost/code/sni-shunt
cp *.tar.gz /srv/gopher/code/sni-shunt
